{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}

{% extends "base.html" %}

{% block title %}{{ file.filename }}{% endblock %}

{% block content %}

<div class="banner">
  <div class="package-header">
    <div class="package-header__left">
      <h1 class="package-header__name">{{ file.filename }}</h1>
    </div>
  </div>
</div>

<div class="file-details">
  <div class="file-details__nav">
    <div class="sidebar-section">
      <h3 class="sidebar-section__title">{% trans %}Navigation{% endtrans %}</h3>
      <nav aria-label="{% trans filename=file.filename %}Navigation for {{ filename }}{% endtrans %}">
        <ul class="vertical-tabs__list" role="tablist">
          <li role="tab">
            <a id="description-tab" href="#contents" class="vertical-tabs__tab vertical-tabs__tab--with-icon vertical-tabs__tab--is-active" aria-selected="true" aria-label="{% trans %}File detail. Focus will be moved to the page contents.{% endtrans %}">
              <i class="fa fa-file" aria-hidden="true"></i>
              {% trans %}File details{% endtrans %}
            </a>
          </li>
          <li role="tab">
            <a id="description-tab" href="{{ request.route_url('packaging.project', name=project.name) }}" class="vertical-tabs__tab vertical-tabs__tab--with-icon" aria-label="{% trans %}Project description. Focus will be moved to the description.{% endtrans %}">
              <i class="fa fa-align-left" aria-hidden="true"></i>
              {% trans %}Project description{% endtrans %}
            </a>
          </li>
          <li role="tab">
            <a id="history-tab" href="{{ request.route_url('packaging.release', name=project.name, version=release.version) }}" class="vertical-tabs__tab vertical-tabs__tab--with-icon" aria-label="{% trans %}Release history. Focus will be moved to the history panel.{% endtrans %}">
              <i class="fa fa-history" aria-hidden="true"></i>
              {% trans version=release.version %}Release {{ version }}{% endtrans %}
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <div class="file-details__contents" id="contents">
    <h2>Details for {{ file.filename }}</h2>
    <h3>Index metadata</h3>
    <div>
      <ul>
        <li>{% trans upload_time=humanize(file.upload_time) %} Uploaded: {{ upload_time }} {% endtrans %}</li>
        <li>{% trans size=file.size|filesizeformat() if file.size else 0|filesizeformat() %} Size: {{ size }} {% endtrans %}</li>
        <li>{% trans tags=', '.join(file.pretty_wheel_tags) %} Tags: {{ tags }} {% endtrans %}</li>
        {% if file.uploaded_via %}
        <li>{% trans uploaded_via=file.uploaded_via %} Uploaded via: {{ uploaded_via }} {% endtrans %}</li>
        {% endif %}
      </ul>
    </div>

    <h3>Integrity information</h3>
    <div>
      <h4>File hashes</h4>
      <div>
        <ul>
          <li>SHA256: {{ file.sha256_digest }}</li>
          <li>MD5: {{ file.md5_digest }}</li>
          <li>BLAKE2b-256: {{ file.blake2_256_digest }}</li>
        </ul>
      </div>

      <h4>Attestations</h4>
      <div>
        <p>
          {% trans is_tp="Yes" if file.uploaded_via_trusted_publisher else "No" %}
          Uploaded using Trusted Publishing? {{ is_tp }}
          {% endtrans %}
        </p>
      </div>

      {% if provenance %}
      <div>
        <p>
          {% trans link=request.route_url('integrity.provenance', project_name=project.name, release=release.version, filename=file.filename) %}
          Provenance: {{ link }}
          {% endtrans %}
        </p>

        <p>
          The following attestations were made for {{ file.filename }}:
        </p>

        {% for bundle in provenance.attestation_bundles %}
        <div class="attestation-bundle">
          <ul>
            <li>
              Publisher: {{ bundle.publisher.kind }}
              <ul>
                <li>Repository: {{ bundle.publisher.repository }}</li>
                <li>Workflow: {{ bundle.publisher.workflow }}</li>
              </ul>
            </li>
            <li>
              Attestations:
              <ul>
                {% for attestation in bundle.attestations %}
                <li>
                  {% set statement = attestation.statement %}
                  Statement type: {{ statement._type }}
                  <ul>
                    <li>Predicate type: {{ statement.predicateType }}</li>
                    <li>Subject name: {{ statement.subject[0].name }}</li>
                    <li>Subject digest: {{ statement.subject[0].digest.sha256 }}</li>
                    <li>Transparency log index: {{ attestation.verification_material.transparency_entries[0].logIndex }} </li>
                    <li>Transparency log integration time: {{ humanize(attestation.verification_material.transparency_entries[0].integratedTime | int | ctime, time="true") }} </li>
                  </ul>
                </li>
                {% endfor %}
              </ul>
            </li>
          </ul>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
</div>


{% endblock %}

