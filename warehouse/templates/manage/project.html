{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}
{% extends "base.html" %}

{% set user = request.user %}
{% set projects = user.projects %}
{% set current_project = project %}
{% set active_page = active_page|default('releases') %}

{% block content %}
  <section class="horizontal-section horizontal-section--thin">
    <div class="site-container">
      <div class="vertical-tabs">
        <div class="vertical-tabs__tabs">
          <div class="sidebar-section">
            <h3 class="sidebar-section__title"><a href="{{ request.route_path('manage.projects') }}">Your Projects</a> ({{ projects|length }})</h3>
            <nav>
            {% for project in request.user.projects %}
              <a class="vertical-tabs__tab vertical-tabs__tab--with-icon {% if project == current_project %}vertical-tabs__tab--is-active{% endif %}" href="{{ request.route_path('manage.project.settings', name=project.normalized_name) }}">
                <i class="fa fa-cube" aria-hidden="true"></i>
                {{ project.name }}
              </a>
              <nav class="vertical-tabs__sub-menu">
                <a href="{{ request.route_path('manage.project.settings', name=project.normalized_name)}}" class="vertical-tabs__sub-tab {% if active_page == 'releases' %}vertical-tabs__sub-tab--is-active{% endif %}"/>Releases</a>
                <a href="{{ request.route_path('manage.project.roles', name=project.normalized_name)}}" class="vertical-tabs__sub-tab {% if active_page == 'collaborators' %}vertical-tabs__sub-tab--is-active{% endif %}" />Collaborators</a>
                <a href="" class="vertical-tabs__sub-tab">Documentation</a>
                <a href="" class="vertical-tabs__sub-tab">Project History (journal)</a>
              </nav>
            {% endfor %}
            </nav>
          </div>
        </div>
        <div class="vertical-tabs__panel">
          <div class="vertical-tabs__content">
            <div class="package-snippet">
              <h1>{{ project.name }}</h1>
              <div class="dropdown">
                <button class="dropdown__trigger button">
                  <i class="fa fa-cog" aria-hidden="true"></i>
                  Project Options
                  <span class="dropdown__trigger-caret">
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                    <span class="sr-only">view submenu</span>
                  </span>
                </button>
                <div class="dropdown__content">
                  <a href="{{ request.route_path('packaging.project', name=project.normalized_name) }}" class="dropdown__link">Preview Project</a>
                  <a href="#" class="dropdown__link">View Package Info</a>
                  <a href="" class="dropdown__link">Delete Project</a>
                  <a href="{{ request.route_path('help')}}#updating-projects" class="dropdown__link">Update Project (help)</a><!-- TODO: add help content -->
                </div>
              </div>
            </div>
            {% block main %}
              <h2>Releases ({{ project.releases|length }})</h2>
              {% if project.releases %}
                <table class="table table--light">
                  <thead>
                    <th>Version</th>
                    <th>Release Date</th>
                    <th>Summary</th>
                    <th></th>
                  </thead>
                  <tbody>
                    {% for release in project.releases %}
                      <tr>
                        <td><a href="TODO: link to release edit page">{{ release.version }}</a></td>
                        <td><time class="-js-relative-time" datetime="{{ release.created|format_datetime('yyyy-MM-ddTHH:mm:ss') }}">{{ release.created|format_date()}}</time></td>
                        <td>
                          {% if release.summary %}
                            {{ release.summary }}
                          {% else %}
                            &mdash;
                          {% endif %}
                          </td>
                        <td>
                          <div class="dropdown">
                            <button class="dropdown__trigger button">
                              Options
                              <span class="dropdown__trigger-caret">
                                <i class="fa fa-caret-down" aria-hidden="true"></i>
                                <span class="sr-only">view submenu</span>
                              </span>
                            </button>
                            <div class="dropdown__content">
                              <a href="{{ request.route_path('packaging.release', name=release.project.name, version=release.version) }}" class="dropdown__link">Preview</a>
                              <a href="" class="dropdown__link">Delete</a>
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>

              {% else %}
                No releases yet!
              {% endif %}
            {% endblock %}
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
