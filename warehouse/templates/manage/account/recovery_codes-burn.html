{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}
{% extends "manage/manage_base.html" %}

{% set user = request.user %}
{% set title = gettext("Use a recovery code") %}

{% set active_tab = 'account' %}

{% block title %}
  {{ title }}
{% endblock %}

{# Hide mobile search on manager pages #}
{% block mobile_search %}{% endblock %}

{% block content %}
<div class="horizontal-section">
  <div class="site-container">
    <div class="col-half">
      <h1 class="page-title page-title--wsubtitle heading-wsubtitle__heading">{{ title }}</h1>
      <p>
      {% trans %}
        In order to verify that you have safely stored your recovery codes for use in the event of a lost 2FA device, submit one of your recovery codes here.
      {% endtrans %}
      </p>
      <p>
      {% trans %}
        The recovery code you choose will be considered used and no longer be available to bypass 2FA.
      {% endtrans %}
      </p>
      <p>
      {% trans %}
      <strong>Forgot to safely store your recovery codes?</strong> You'll need to generate them again.
      {% endtrans %}
      </p>
      <a href="{{ request.route_path('manage.account.recovery-codes.regenerate') }}" class="button button--secondary">
        {% trans %}Regenerate{% endtrans %}
      </a>
    </div>
    <div class="col-half">
      <div>
        <form method="POST" action="{{ request.current_route_path() }}">
          <input name="csrf_token" type="hidden" value="{{ request.session.get_csrf_token() }}">
          <input name="method" type="hidden" value="recovery-code">

          {% if form.errors.__all__ %}
          <ul class="form-errors" role="alert">
            {% for error in form.errors.__all__ %}
            <li>{{ error }}</li>
            {% endfor %}
          </ul>
          {% endif %}

          <div class="form-group">
            <label for="recovery_code_value" class="form-group__label">
              {% trans %}Enter recovery code{% endtrans %}
              {% if form.recovery_code_value.flags.required %}
              <span class="form-group__required">{% trans %}(required){% endtrans %}</span>
              {% endif %}
            </label>
            {{ form.recovery_code_value(autocapitalize="off", spellcheck="false", required="required", class_="form-group__field", autocomplete="one-time-code", **{"aria-describedby":"recovery_code-errors"}) }}
            {% if form.recovery_code_value.errors %}
            <ul id="recovery_code-errors" class="form-errors" role="alert">
              {% for error in form.recovery_code_value.errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
          <div class="form-group">
            <input type="submit" value="{% trans %}Verify{% endtrans %}" class="button button--primary">
          </div>

        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}
