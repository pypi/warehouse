{#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
-#}
{% extends "email/_base/body.html" %}

{% set domain = request.registry.settings.get('warehouse.domain') %}

{% block content %}
  <p>
    {% trans publisher_name=publisher.publisher_name, project_name=project_name, environment_name=environment_name,
    project_href=request.route_url('packaging.project', name=project_name, _host=domain)
    %}
      A Trusted Publisher for project <a href="{{ project_href }}">{{ project_name }}</a> was just
      used from a CI/CD job configured with a {{ publisher_name }} environment.
      The environment used was: <strong>{{ environment_name }}</strong>.
    {% endtrans %}
  </p>
    {% trans %}
  <p>
      Since the Trusted Publisher is configured to allow <strong>any</strong> environment,
      for security reasons we recommend constraining it to only one.
  </p>
    {% endtrans %}
  <p>
    {% trans environment_name=environment_name,
    auto_href=request.route_url('manage.project.settings.publishing', project_name=project_name, _host=domain,
                                _query={'publisher_id': publisher.id, 'constrain_environment': environment_name })
    %}
     If you are an owner of this project, you can automatically constrain this Trusted Publisher to
     '{{ environment_name }}' by following this link: <a href="{{ auto_href }}">constrain publisher</a>.
    {% endtrans %}
  </p>
  <p>
    {% trans environment_name=environment_name,
    manual_href=request.route_url('manage.project.settings.publishing', project_name=project_name, _host=domain)
    %}
     Alternatively, you can do this manually by going to the project's
     <a href="{{ manual_href }}">publishing settings</a>, deleting
    the existing Trusted Publisher and creating a new one with the environment set to '{{ environment_name }}'.
    {% endtrans %}
  </p>
  <p>
    {% trans href='mailto:admin@pypi.org', email_address='admin@pypi.org' %}
      If you have questions, you can email
      <a href="{{ href }}">{{ email_address }}</a> to communicate with the PyPI
      administrators.
    {% endtrans %}
  </p>
{% endblock %}
