from zope.interface import implementer

from warehouse.malware.interfaces import IMalwareCheckService
from warehouse.malware.tasks import run_check


@implementer(IMalwareCheckService)
class PrinterMalwareCheckService:
    def __init__(self, executor):
        self.executor = executor

    @classmethod
    def create_service(cls, context, request):
        return cls(print)

    def run_checks(self, checks):
        for check in checks:
            self.executor(check)


@implementer(IMalwareCheckService)
class DatabaseMalwareCheckService:
    def __init__(self, executor):
        self.executor = executor

    @classmethod
    def create_service(cls, context, request):
        return cls(request.task(run_check).delay)

    def run_checks(self, checks):
        for check_info in checks:
            check_name, obj_id = check_info.split(":")
            self.executor(check_name, obj_id)
