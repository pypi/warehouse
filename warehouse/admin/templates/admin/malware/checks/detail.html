{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}
{% extends "admin/base.html" %}

{% block title %}{{ check.name }}{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{{ request.route_path('admin.checks.list') }}">Checks</a></li>
  <li class="breadcrumb-item active">{{ check.name }}</li>
{% endblock %}

{% block content %}
  <div class="card card-primary">
    <div class="card-body">
      <p>{{ check.long_description }}</p>
      <h4>Revision History</h4>
      <div class="card-body">
        <table class="table table-hover table-striped">
          <thead>
          <tr>
            <th>Version</th>
            <th>State</th>
            {% if check.check_type.value == "event_hook" %}
            <th>Hooked Object</th>
            {% else %}
            <th>Schedule</th>
            {% endif %}
            <th>Created</th>
          </tr>
          </thead>
          <tbody>
          {% for c in checks %}
          <tr>
            <td>{{ c.version }}</td>
            <td>{{ c.state.value }}</td>
            {% if check.check_type.value == "event_hook" %}
            <td>{{ c.hooked_object.value }}</td>
            {% else %}
            <td><pre>{{ c.schedule }}</pre></td>
            {% endif %}
            <td>{{ c.created }}</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="card card-primary">
    <div class="card-header">
      <h3 class="card-title">Change State</h3>
    </div>
    <form method="POST" action="{{ request.route_path('admin.checks.change_state', check_name=check.name) }}">
      <input name="csrf_token" type="hidden" value="{{ request.session.get_csrf_token() }}">
      <div class="card-body">
        <div class="form-group col-sm-4">
          <select class="form-control" name="check_state">
            {% for state in states %}
            <option value="{{ state.value }}" {{'disabled selected' if check.state == state else ''}}>
              {{ state.value }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="float-right col-sm-4">
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </div>
    </form>
  </div>
  <div class="card card-primary">
    <div class="card-header">
      <h3 class="card-title">Run Evaluation</h3>
    </div>
    <form method="POST" action="{{ request.route_path('admin.checks.run_evaluation', check_name=check.name) }}">
      <input name="csrf_token" type="hidden" value="{{ request.session.get_csrf_token() }}">
      <div class="card-body">
        {% if check.check_type.value == "event_hook" %}
        <p>Run this check against {{ evaluation_run_size }} {{ check.hooked_object.value }}s, selected at random. This is used to evaluate the efficacy of a check.</p>
        {% else %}
        <p>Execute this check now.</p>
        {% endif %}
        <div class="float-right col-sm-4">
          <button type="submit" class="btn btn-primary">Run</button>
        </div>
      </div>
    </form>
  </div>
{% endblock %}
