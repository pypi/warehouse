{#
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 # http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-#}
{% extends "admin/base.html" %}

{% block title %}{{ check.name }}{% endblock %}

{% block breadcrumb %}
  <li><a href="{{ request.route_path('admin.checks.list') }}">Checks</a></li>
  <li class="active">{{ check.name }}</li>
{% endblock %}

{% block content %}
  <div class="box box-primary">
    <div class="box-body box-profile">
      <p>{{ check.long_description }}</p>
      <h4>Revision History</h4>
      <div class="box-body box-attributes">
        <table class="table table-hover">
          <tr>
            <th>Version</th>
            <th>State</th>
            <th>Created</th>
          </tr>
          {% for c in checks %}
          <tr>
            <td>{{ c.version }}</td>
            <td>{{ c.state.value }}</td>
            <td>{{ c.created }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>
  <div class="box box-primary">
    <div class="box-header with-border">
      <h3 class="box-title">Change State</h3>
    </div>
    <form method="POST" action="{{ request.route_path('admin.checks.change_state', check_name=check.name) }}">
      <input name="csrf_token" type="hidden" value="{{ request.session.get_csrf_token() }}">
      <div class="box-body">
        <div class="form-group col-sm-4">
          <select class="form-control" name="check_state">
            {% for state in states %}
            <option value="{{ state.value }}" {{'disabled selected' if check.state == state else ''}}>
              {{ state.value }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="pull-right col-sm-4">
          <button type="submit" class="btn btn-primary pull-right">Save</button>
        </div>
      </div>
    </form>
  </div>
  <div class="box box-primary">
    <div class="box-header with-border">
      <h3 class="box-title">Run Backfill</h3>
    </div>
    <form method="POST" action="{{ request.route_path('admin.checks.run_backfill', check_name=check.name) }}">
      <input name="csrf_token" type="hidden" value="{{ request.session.get_csrf_token() }}">
      <div class="box-body">
        <p>Run this check against 10,000 {{ check.hooked_object.value }}s, selected at random. This is used to evaluate the efficacy of a check.</p>
        <div class="pull-right col-sm-4">
          <button type="submit" class="btn btn-primary pull-right">Run</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}
